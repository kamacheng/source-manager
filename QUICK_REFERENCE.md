# 资源引用检查功能 - 快速参考

## 🎯 功能简介

检查已删除的 sourceKey 在客户端配置中的引用情况。

## 📍 位置

顶部导航栏 → 链接图标 (⛓️)

```
[资源统计] [⛓️ 检查] [📜 日志] [⚙️ 设置]
              ↑
         新增功能按钮
```

## ⚡ 快速操作

1. **点击** ⛓️ 图标
2. **等待** 1 秒检查完成
3. **查看** 弹窗中的检查结果

## 📊 结果解读

### 三个关键指标

| 指标 | 说明 | 颜色 |
|------|------|------|
| 后台资源总数 | DB 中的资源数 | 灰色 |
| 有效引用总数 | 配置中存在的引用 | 绿色 |
| 被删除的引用 | DB 中已删除但仍被引用 | 红色 |

### 被删除的引用结构

```
sourceKey: weapon_sword_deprecated
├─ 应用来源: [道具配置 v1.0]
└─ 使用详情:
   ├─ 道具ID: hero_item_001
   └─ 用途: 角色头像
```

## 🎨 颜色含义

- 🟢 **绿色** - 正常/有效
- 🔴 **红色** - 警告/问题
- 🟡 **琥珀** - 检查中
- ⚪ **灰色** - 信息

## 💡 何时使用

### ✅ 应该检查

| 场景 | 时机 |
|------|------|
| 删除 sourceKey | 删除前 |
| 修改配置 | 完成后 |
| 发布应用 | 发布前 |
| 问题排查 | 配置无效时 |

### ❌ 问题时的处理

**发现被删除的引用**
1. 查看"应用来源" - 找到哪个配置在引用
2. 查看"使用详情" - 了解具体的道具和用途
3. 选择修复方案：
   - 恢复该 sourceKey（重新上传）
   - 更新配置，使用其他 sourceKey
   - 保留映射（不删除）

## 🔧 功能详细说明

| 功能 | 说明 |
|------|------|
| 统计卡片 | 快速了解资源和引用情况 |
| 有效引用统计 | 按类型显示引用分布 |
| 被删除引用列表 | 详细的问题定位信息 |
| 复制报告 | 导出为文本用于记录 |

## 📝 数据来源

| 项目 | 来源 |
|------|------|
| 后台资源 | items 数组中的 resourceKey |
| 配置引用 | 模拟的客户端配置 |
| 检查时间 | 系统当前时间 |

*注：当前为演示数据，集成真实 API 时需修改数据源*

## 🚀 集成步骤

当准备集成真实数据库时：

1. **修改数据来源**
   ```javascript
   // 替换模拟数据的这部分：
   const databaseSourceKeys = new Set(items.map(item => item.resourceKey));
   const clientConfigs = [...]; // 获取实际数据
   ```

2. **添加 API 调用**
   ```javascript
   const response = await fetch('/api/check-references');
   const { databaseSourceKeys, clientConfigs } = await response.json();
   ```

3. **测试检查结果**
   - 验证统计数据准确性
   - 确认被删除引用的完整性

## 📋 检查清单

实现完整后需要检查：

- [ ] 按钮能正确响应点击
- [ ] 加载状态正确显示
- [ ] 弹窗正确显示结果
- [ ] 数据统计准确
- [ ] 被删除引用完整显示
- [ ] 应用来源准确
- [ ] 使用详情清晰
- [ ] 复制报告功能可用
- [ ] 关闭按钮工作正常
- [ ] 操作日志有记录

## 🎓 示例场景

### 场景 1：正常情况
```
检查结果：✓ 无问题
- 后台资源: 30
- 有效引用: 45
- 被删除引用: 0
→ 可以安全发布
```

### 场景 2：发现问题
```
检查结果：⚠️ 发现问题
- 后台资源: 30
- 有效引用: 42
- 被删除引用: 3

问题列表：
1. deleted_weapon_key
   来源: 道具配置 v1.0
   道具: weapon_002

2. missing_skill_effect
   来源: 技能配置 v2.1
   道具: skill_ice

3. old_voice_key
   来源: 音频配置 v1.5
   道具: voice_hero

→ 需要修复问题后再发布
```

## 📞 技术支持

遇到问题？
- 检查 `FEATURE_REFERENCE_CHECK.md` - 详细使用指南
- 查看 `IMPLEMENTATION_SUMMARY.md` - 技术实现细节
- 参考 `TEST_GUIDE.md` - 测试说明

## 🔄 工作流示例

```
修改配置
    ↓
删除某个 sourceKey
    ↓
[点击检查按钮]
    ↓
是否发现被删除引用？
    ├─ 否 → 正常发布 ✓
    └─ 是 → 修复问题
         ├─ 恢复 sourceKey
         ├─ 更新配置
         └─ 或保留映射
         ↓
    [重新检查]
         ↓
    无问题后发布 ✓
```
