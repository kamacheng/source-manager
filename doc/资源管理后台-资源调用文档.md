# 资源管理后台-后台资源调用文档

## 0. 文件信息

> **建议文件名**：`资源管理后台-后台资源调用文档.md`
> **文档版本**：v1.0
> **编写日期**：2026-01-21

---

## 1. 概述

本文档描述游戏后台系统如何调用和使用资源管理系统中的资源。资源管理后台主要负责统一管理游戏中的图片、视频、音频等多媒体资源，为游戏客户端和其他后台服务提供资源查询、存储和访问能力。

### 1.1 核心概念

| 概念 | 说明 |
| --- | --- |
| **资源Key** | 资源的唯一标识符，通过此标识符引用资源（如：`icon_sword_001`） |
| **显示名称** | 资源在后台的备注/描述名称，便于管理员识别（如：`武器-剑类-长剑图标`） |
| **资源类型** | 资源的媒体类型，包括：图片(image)、视频(video)、音频(audio) |
| **资源分类** | 树形分类结构，用于组织和管理资源 |
| **物理路径** | 资源在云存储中的实际存储路径，上传后不可变 |
| **逻辑路径** | 资源在分类树中的路径，分类变更时自动更新 |
| **优化状态** | 标记资源是否包含优化版本（仅图片资源支持ASTC格式优化） |

### 1.2 资源来源

系统支持两种资源来源：

| 来源 | 说明 | 标识方式 | 管理方式 |
| --- | --- | --- | --- |
| **后台资源** | 通过资源管理后台上传的资源 | 无前缀（直接使用资源名） | 后台管理系统统一管理 |
| **本地资源** | 客户端内置的资源文件 | 以 `_` 开头的资源名 | 客户端版本内置，无需后台管理 |

---

## 2. 资源标识与命名规范

### 2.1 资源标识方式

#### 2.1.1 后台资源标识
- **格式**：直接使用 `resourceKey`（资源名称）
- **示例**：
  - `icon_sword_001`      // 后台上传的长剑图标
  - `hero_portrait_001`   // 后台上传的英雄立绘
  - `battle_bgm_01`       // 后台上传的战斗BGM
- **来源**：从资源管理后台上传

#### 2.1.2 本地资源标识
- **格式**：`_resourceKey`（以下划线为前缀）
- **示例**：
  - `_ui_icon_coin`       // 本地内置的金币图标
  - `_ui_button_confirm`  // 本地内置的确认按钮
- **来源**：客户端内置资源

### 2.2 命名规范

| 规则项 | 要求 | 示例 |
| --- | --- | --- |
| **全局唯一性** | 同一资源管理系统内，资源名称必须唯一 | 不能有两个 `icon_sword_001` |
| **禁止下划线开头** | 后台资源名称不能以下划线开头，避免与本地资源冲突 | ❌ `_icon_001`<br/>✅ `icon_001` |
| **推荐前缀** | 使用功能性前缀便于分类和识别 | `icon_` / `bg_` / `portrait_` / `bgm_` / `sfx_` |


---

## 3. 资源指定与查询

### 3.1 资源指定方式

后台系统在以下场景中需要指定资源：

| 场景 | 说明 | 示例字段名 |
| --- | --- | --- |
| **游戏配置** | 在游戏配置表中指定UI、装备、角色等资源 | `heroIcon`, `weaponIcon`, `skillIcon` |
| **活动配置** | 活动、副本、任务等配置中指定相关资源 | `activityBanner`, `taskIcon`, `rewardIcon` |
| **问卷配置** | 问卷选项中指定展示资源 | `optionImage`, `answerIcon` |
| **用户数据** | 用户头像、皮肤等个性化资源 | `userAvatar`, `userSkinIcon` |
| **道具配置** | 道具、装备、怪物等配置中指定展示资源 | `itemIcon`, `equipmentIcon`, `monsterPortrait` |

### 3.2 指定规则

资源通过 `resourceKey` 字段指定：

**指定规则**：
1. 直接使用资源的唯一标识符（resourceKey）
2. 后台资源无需前缀：`icon_sword_001`
3. 本地资源需加下划线前缀：`_ui_icon_coin`
4. 不需要指定资源的完整路径或扩展名，系统会自动查询

---

## 4. 资源查询逻辑

### 4.1 查询流程

当游戏客户端或后台需要使用某个资源时，资源查询系统会根据资源Key按照以下流程进行查询：

**查询决策树**：

```
输入资源Key → 判断是否以下划线开头
              ↙              ↘
            是                否
            ↓                 ↓
        本地资源查询        后台资源查询
            ↓                 ↓
        找到资源？        找到资源？
        ↙      ↘          ↙      ↘
       是       否        是       否
       ↓        ↓         ↓        ↓
     返回    返回error  返回资源   返回error
    本地资源        (云存储)  (资源不存在)
```

### 4.2 查询步骤

| 步骤 | 说明 | 具体判断逻辑 |
| --- | --- | --- |
| **步骤1：识别资源类型** | 根据resourceKey前缀确定资源来源 | 以 `_` 开头 → 本地资源<br/>否则 → 后台资源 |
| **步骤2：查询资源** | 从对应的资源库中查找资源 | 本地：客户端内置资源<br/>后台：资源管理数据库 |
| **步骤3：验证资源** | 检查资源是否存在且有效 | 文件/记录存在且未被删除 |
| **步骤4：返回结果** | 返回资源数据或错误信息 | 成功：资源信息<br/>失败：错误码和错误信息 |

---
