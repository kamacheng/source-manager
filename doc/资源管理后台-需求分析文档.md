## 1. 文件信息
> **建议文件名**：`资源管理后台-需求分析文档.md`
> **文档版本**：v1.1
> **编写日期**：2026-01-19

## 2. 需求详情

**功能模块：资源管理后台**

### 2.1 系统定位
- **管理范围**：仅管理通过后台上传的资源；客户端内置本地资源通过下划线前缀(`_resourceKey`)区分。
>[!question]- #石 
>上述是后缀吧？

- **分类逻辑**：多级分类结构（无限层级），支持按资源类型筛选，资源所在分类层级作为标签系统。
- **URL生成**：资源上传后生成访问URL，遵循开发规范。
- **优化策略**：支持上传图片的astc优化版本，需显示优化状态。

### 2.2 核心功能

#### 2.2.1 分类管理
- **结构**：支持无限层级树形分类结构，分类可存放资源或仅用于组织。
- **操作**：
  - 新增：自动检测当前父级下名称唯一性
  - 重命名/移动：自动检测目标父级下名称唯一性，需显示影响范围确认
  - 删除：需先清空子级分类和资源
- **规则**：同一父分类下子分类名唯一

#### 2.2.2 资源管理
- **上传**：
  - 批量上传原始资源，图片可选择上传astc优化版本
  - 资源名称禁止以下划线开头（避免与本地资源冲突）
  - 批量上传需确保原始资源与优化版本的关联关系
- **检索**：
  - 基础搜索：按资源名、分类、显示名称模糊搜索
  - 高级筛选：按资源类型、文件大小、上传时间、优化状态筛选
- **预览**：支持图片/视频/音频在线预览
- **编辑**：修改显示名称、分类归属
- **迁移**：
  - 支持多选资源批量迁移至目标分类
  - 迁移前显示影响确认（资源数量、目标路径）
  - 批量操作失败时需撤销全部改动
- **查看**：
  - 资源列表显示关键属性（大小、尺寸、时长、优化状态等）
  - 资源详情显示完整元数据（名称、显示名称、创建/修改时间、上传者等）

#### 2.2.3 系统功能
- **操作日志**：记录资源和分类的增删改操作，包含操作人、时间、类型、对象、详情
- **性能要求**：
  - 资源列表分页加载（默认50条/页，支持20/50/100切换）
  - 大文件（>10MB）上传支持断点续传
  - 批量操作异步处理并显示进度

### 2.3 核心规则

#### 2.3.1 枚举定义
- **资源类型**：image（图片）、video（视频）、audio（音频）
- **资源引用**：
  - 后台资源直接使用name字段（如：icon_sword_001）
  - 本地资源使用下划线前缀+name（如：_ui_icon_coin）

#### 2.3.2 关键规则
- **资源路径**：
  - 物理路径：上传后生成不可变路径，存储在云存储中
  - 逻辑路径：分类路径用于展示与查询，分类变更不影响物理路径
- **上传校验**：
  - 校验文件类型（图片/视频/音频）
  - 校验文件大小（符合云存储限制）
  - 校验资源名称（全局唯一，禁止下划线开头）
- **优化资源**：
  - 格式限制：仅支持astc格式（图片）
  - 存储规则：与原始资源同一分类，同名不同格式
  - 上传规则：可单独上传原始资源，补传优化版本时需验证原始资源存在
  - 删除规则：删除原始资源时自动删除关联优化资源，可单独删除优化资源
- **数据一致性**：
  - 系统记录为唯一事实来源
  - 批量操作需确保完整性，避免数据不一致

### 2.4 业务异常处理
- **资源相关**：
  - 资源名称重复："资源名称已存在，请使用其他名称"
  - 资源名称以下划线开头："资源名称不能以下划线开头"
  - 文件过大："文件大小超过限制"
  - 上传失败："文件上传失败，请重试"
- **分类相关**：
  - 分类名称重复："分类名已存在，请使用其他名称"
  - 删除包含子分类："无法删除，该分类下仍有子分类"
  - 删除包含资源："无法删除，该分类下仍有资源，请先迁移"
- **批量操作**：
  - 未选择资源："请至少选择一个资源"
  - 目标分类不存在："目标分类不存在"
  - 大量操作（>1000条）："正在迁移大量资源，操作可能需要较长时间，是否继续？"
- **优化资源**：
  - 缺少原始资源："缺少原始资源，请先上传原始资源文件"