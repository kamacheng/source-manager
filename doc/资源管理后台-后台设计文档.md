# 资源管理后台-后台设计文档

## 0. 文件信息
> **建议文件名**：`资源管理后台-后台设计文档.md`

---

## [示例后台](https://kamacheng.github.io/source-manager/)

- 后台入口：游戏管理 → 活动配置 → 资源管理


## 1. 资源管理页

### 1.1 页面入口

| 项目     | 说明                           |
| -------- | ------------------------------ |
| 入口位置 | 游戏管理 → 活动配置 → 资源管理 |

**页面截图**：

![全部资源](../ref/全部资源.png)


### 1.2 筛选条件

| 筛选项名称 | 输入类型   | 默认值 | 业务规则                                                                                         |
| ---------- | ---------- | ------ | ------------------------------------------------------------------------------------------------ |
| 搜索关键词 | 文本输入框 | 空     | 可选，可填入sourceKey和显示名称模糊搜索<br>根据输入内容筛选列表<br>在玩家按下enter键后搜索数据库 |
| 资源类型   | 单选下拉框 | 全部   | 可选，支持按图片、视频、音频筛选                                                                 |
| 资源分类   | 树形下拉框 | 全部   | 可选，支持按多级分类筛选                                                                         |
| 优化状态   | 单选下拉框 | 全部   | 可选，支持按已优化、未优化筛选                                                                   |


**筛选项枚举值**：

| 筛选项   | 可选值                          |
| -------- | ------------------------------- |
| 资源类型 | 1. 全部 2. 图片 3. 视频 4. 音频 |
| 优化状态 | 1. 全部 2. 已优化 3. 未优化     |

### 1.3 列表展示

**展示方式**：卡片式网格布局，支持批量选择和预览

**资源卡片字段**：

| 序号  | 字段名称   | 字段说明            | 交互行为                      |
| --- | ------ | --------------- | ------------------------- |
| 1   | 选择框    | 用于批量操作          | 点击选中/取消选中资源               |
| 2   | 资源预览   | 图片/视频/音频缩略图     | 点击放大预览                    |
| 3   | 媒体类型标签 | 图片/视频/音频        | 右上角显示媒体类型标签               |
| 4   | 资源key  | 资源的唯一标识符        | 显示前缀"Key: "，支持搜索高亮        |
| 5   | 显示名称   | 资源的展示名称（后台备注文本） | 支持搜索高亮                    |
| 6   | 最后变动时间 | 资源最后变动的时间       | 无                         |
| 7   | 最后操作人员 | 最后操作资源的用户       | 无                         |
| 8   | 分类标签   | 资源所属分类          | 显示分类名称                    |
| 9   | 优化状态   | 是否已上传ASTC优化版本   | 右下角显示"已优化"/"未优化"标签（仅图片资源） |
| 10  | 操作     | 资源的操作按钮组        | 包含预览、复制、编辑、删除按钮           |

**排序规则**：
- 默认按上传时间倒序排列
- 搜索时精确匹配优先排序

**空状态**：无资源时显示空白状态提示

**批量操作工具栏**：选中资源时显示，包含已选择资源数量、批量迁移、取消选择按钮

### 1.4 页面操作

**简单操作**：

| 按钮名称 | 位置    | 点击行为                |
| ---- | ----- | ------------------- |
| 批量上传 | 列表区上方 | 打开批量上传弹窗（选中叶子分类）    |
| 批量迁移 | 列表区上方 | 打开批量迁移弹窗（需至少选择一个资源） |
| 分类管理 | 右上角   | 打开分类管理弹窗            |
| 操作日志 | 右上角   | 打开操作日志信息            |

**详细操作**：

1. 事件【点击"编辑"按钮】
   - 前置判断：无
   - 执行过程：
     - 步骤1：打开【资源编辑弹窗】，显示当前资源信息
     - 步骤2：可修改`显示名称`
     - 步骤3：点击【保存】，提交修改
   - 结果反馈：
     - ✅ 成功：提示"资源修改成功"，关闭弹窗并刷新当前页
     - ❌ 失败：提示具体错误原因


2. 事件【点击"复制"按钮】
   - 前置判断：无
   - 结果反馈：
     - 右下角气泡"已复制：`选中资源的sourceKey`"

3. 事件【点击"预览"按钮】
   - 前置判断：无
   - 执行过程：
     - 步骤1：请求远端资源数据
     - 步骤2：资源加载完成后可进行预览（播放视频、音频、显示图片）
   - 结果反馈：
     - ❌ 失败：提示具体错误原因

4. 事件【点击"删除"按钮】
   - 前置判断：无
   - 执行过程：
     - 步骤1：弹出确认提示框"确定要删除该资源吗？"
     - 步骤2：点击【确定】，提交删除请求
   - 结果反馈：
     - ✅ 成功：提示"资源删除成功"，关闭提示框并刷新当前页
     - ❌ 失败：提示具体错误原因

5. 事件【点击"批量迁移"按钮】
   - 前置判断：是否至少选择了一个资源
     - ❌ 若未选择：提示"请至少选择一个资源"
     - ✅ 若已选择：打开【批量迁移弹窗】
   - 执行过程：
     - 步骤1：选择目标分类
     - 步骤2：显示影响确认（资源数量、目标路径）
     - 步骤3：点击【确认迁移】，提交批量迁移请求
   - 结果反馈：
     - ✅ 成功：提示"资源批量迁移成功"，关闭弹窗并刷新当前页
     - ❌ 失败：提示具体错误原因，撤销全部改动

---

## 2. 分类管理弹窗

### 2.1 页面入口

| 项目     | 说明                            |
| -------- | ------------------------------- |
| 入口位置 | 资源管理页 → 右上角分类管理按钮 |

**页面截图**：

![分类管理](../ref/分类管理.png)

### 2.2 弹窗内容

**整体布局**：
- 按资源类型（图片、视频、音频）分栏展示分类树
- 每个类型栏包含类型标题、根分类数量和新增根分类按钮
- 分类树支持无限层级展开/收起

**页面截图（叶子节点）**：

![叶子节点](../ref/叶子节点.png)

**分类树展示字段**：

| 序号  | 字段名称  | 字段说明       | 交互行为                                   |
| --- | ----- | ---------- | -------------------------------------- |
| 1   | 展开/收起 | 展开或收起子分类   | 点击展开/收起树形结构                            |
| 2   | 分类图标  | 区分文件夹和叶子节点 | 文件夹：文件夹图标；叶子节点：标签图标<br>叶子节点：节点下没有其他子节点 |
| 3   | 分类名称  | 分类的显示名称    | 无                                      |
| 4   | 资源数量  | 分类下的资源数量   | 显示在分类名称右侧                              |
| 5   | 操作    | 分类的操作按钮组   | 包含新增子分类、编辑、删除按钮                        |

### 2.3 页面操作

**简单操作**：

| 按钮名称   | 位置       | 点击行为           |
| ---------- | ---------- | ------------------ |
| 新增根分类 | 类型栏右侧 | 打开新增根分类表单 |

**详细操作**：

1. 事件【点击"新增子分类"按钮】
   - 前置判断：检查当前分类下是否有资源
     - ❌ 若有资源：提示"该分类下有资源，请先迁移资源后再添加子分类"
     - ✅ 若无资源：显示新增子分类表单
   - 执行过程：
     - 步骤1：输入子分类名称和文件夹名称
     - 步骤2：点击【添加】，提交新增请求
   - 结果反馈：
     - ✅ 成功：提示"子分类添加成功"，更新分类树
     - ❌ 失败：提示具体错误原因（如分类名重复）

2. 事件【点击"编辑"按钮】
   - 前置判断：无
   - 执行过程：
     - 步骤1：切换到分类编辑模式
     - 步骤2：修改分类名称或文件夹名称
     - 步骤3：点击【保存】，提交修改
   - 结果反馈：
     - ✅ 成功：提示"分类修改成功"，更新分类树
     - ❌ 失败：提示具体错误原因（如分类名重复）

3. 事件【点击"删除"按钮】
   - 前置判断：检查分类下是否有子分类或资源
     - ❌ 若有子分类：提示"无法删除，该分类下仍有子分类"
     - ❌ 若有资源：提示"无法删除，该分类下仍有资源，请先迁移"
     - ✅ 若为空：弹出确认提示框"确定要删除该分类吗？"
   - 执行过程：
     - 步骤1：点击【确定】，提交删除请求
   - 结果反馈：
     - ✅ 成功：提示"分类删除成功"，更新分类树
     - ❌ 失败：提示具体错误原因

**快捷操作**：
- 按 Enter 键：保存当前编辑
- 按 Esc 键：取消当前编辑

---

## 3. 批量上传功能

### 3.1 功能入口

| 项目     | 说明                      |
| -------- | ------------------------- |
| 入口位置 | 资源管理页 → 批量上传按钮 |

### 3.2 功能说明

**功能概述**：
- 支持批量上传原始资源文件
- 图片资源可同时上传`ASTC`优化版本
- 自动处理原始资源与优化版本的关联关系

**上传规则**：

| 规则项   | 业务规则                                           |
| -------- | -------------------------------------------------- |
| 目标分类 | 必选，仅在叶子分类下可用                           |
| 文件格式 | 支持图片、视频、音频格式                           |
| 资源命名 | 禁止以下划线开头（避免与本地资源冲突）             |
| ASTC处理 | 自动检测同批上传中的ASTC文件，并与对应原始资源关联 |

### 3.3 操作流程

1. 事件【点击"批量上传"按钮】
   - 前置判断：
     - 是否选择了叶子分类
       - ❌ 若未选择：按钮置灰不可用
   - 执行过程：
     - 步骤1：打开文件选择对话框
     - 步骤2：选择要上传的文件（可多选）
   - 结果反馈：开始上传文件

2. 文件上传过程
   - 执行过程：
     - 步骤1：验证文件格式和大小
     - 步骤2：验证资源名称是否符合规则（禁止以下划线开头）
     - 步骤3：分离原始资源和ASTC优化资源
     - 步骤4：批量上传文件到服务器
     - 步骤5：关联原始资源和ASTC优化版本（如有）
   - 结果反馈：
     - ✅ 成功：提示"文件上传成功"，刷新资源列表
     - ❌ 失败：提示具体错误原因，显示上传失败的文件列表

---

## 4. 资源预览弹窗

### 4.1 页面入口

| 项目     | 说明                                  |
| -------- | ------------------------------------- |
| 入口位置 | 资源管理页 → 点击资源预览区或预览按钮 |

**页面截图**：

![视频预览](../ref/视频预览.png)

### 4.2 弹窗内容

**整体布局**：
- 顶部显示弹窗标题和关闭按钮
- 中部显示资源预览区
- 底部显示资源信息和操作按钮

**预览区域**：

| 媒体类型 | 预览功能                             |
| -------- | ------------------------------------ |
| 图片     | 显示原始尺寸图片，支持放大查看       |
| 视频     | 支持播放、暂停、进度条控制，自动播放 |
| 音频     | 支持播放、暂停、进度条控制，自动播放 |

**资源信息**：

| 信息项     | 说明                 | 媒体类型  |
| ---------- | -------------------- | --------- |
| 资源名称   | 资源的展示名称       | 全部      |
| 资源Key    | 资源的唯一标识符     | 全部      |
| 图片分辨率 | 图片的宽度和高度     | 图片      |
| 视频分辨率 | 视频的宽度和高度     | 视频      |
| 时长       | 视频或音频的播放时长 | 视频/音频 |

### 4.3 页面操作

**简单操作**：

| 按钮名称 | 位置       | 点击行为     |
| -------- | ---------- | ------------ |
| 关闭     | 弹窗右上角 | 关闭预览弹窗 |
| 关闭预览 | 弹窗底部   | 关闭预览弹窗 |

---

## 5. 资源编辑弹窗

### 5.1 页面入口

| 项目     | 说明                        |
| -------- | --------------------------- |
| 入口位置 | 资源管理页 → 点击"编辑"按钮 |

**页面截图**：

![资源详情](../ref/资源详情.png)

### 5.2 弹窗内容

**整体布局**：
- 顶部显示弹窗标题和关闭按钮
- 左侧显示资源预览
- 右侧显示资源基本信息
- 中部显示资源路径信息
- 底部显示变更记录和操作按钮

**资源信息展示**：

| 字段名称  | 输入类型  | 业务规则                          |
| ----- | ----- | ----------------------------- |
| 资源预览  | 预览区   | 显示资源缩略图，可点击更换资源               |
| 资源Key | 只读文本框 | 资源的唯一标识符，不可修改<br>根据上传资源的资源名生成 |
| 显示名称  | 文本输入框 | 可选，支持修改资源的展示名称                |
| 上传者   | 只读文本框 | 上传资源的用户，不可修改                  |
| 逻辑路径  | 只读文本框 | 资源的逻辑路径，不可修改                  |
| 物理路径  | 只读文本框 | 资源的物理路径（UUID），不可修改            |

**媒体类型特定信息**：

| 媒体类型 | 字段名称  | 输入类型  | 业务规则       |
| ---- | ----- | ----- | ---------- |
| 图片   | 图片分辨率 | 只读文本框 | 显示图片的宽度和高度 |
| 视频   | 视频分辨率 | 只读文本框 | 显示视频的宽度和高度 |
| 视频   | 时长    | 只读文本框 | 显示视频的播放时长  |

**优化状态**：
- 显示"已上传ASTC优化版本"复选框（只读）

**变更记录**：
- 显示资源的变更历史，包括操作类型、详情、操作人和时间

### 5.3 页面操作

1. 事件【点击"保存"按钮】
   - 前置判断：无
   - 执行过程：
     - 步骤1：验证输入信息
     - 步骤2：检查显示名称是否发生变化
     - 步骤3：提交修改请求
   - 结果反馈：
     - ✅ 成功：提示"资源修改成功"，关闭弹窗并刷新资源列表
     - ❌ 失败：提示具体错误原因

2. 事件【点击"取消"按钮】
   - 前置判断：无
   - 执行过程：关闭弹窗，放弃修改
   - 结果反馈：无

3. 事件【点击资源预览区】
   - 前置判断：无
   - 执行过程：打开文件选择对话框，可更换资源文件
   - 结果反馈：预览区显示新选择的资源

---

## 7. 批量迁移弹窗

### 7.1 页面入口

| 项目     | 说明                                    |
| -------- | --------------------------------------- |
| 入口位置 | 资源管理页 → 批量操作工具栏批量迁移按钮 |

**页面截图**：

![批量迁移](../ref/批量迁移.png)

### 7.2 弹窗内容

**整体布局**：
- 顶部显示弹窗标题和已选择资源数量
- 中部显示目标分类选择树
- 底部显示操作按钮

**迁移设置**：

| 设置项名称 | 输入类型   | 默认值 | 业务规则                                       |
| ---------- | ---------- | ------ | ---------------------------------------------- |
| 目标分类   | 树形选择器 | 空     | 必选，选择资源迁移的目标分类（仅叶子节点可选） |

**影响范围**：
- 顶部显示"将选中的 X 个资源迁移到目标分类"

### 7.3 页面操作

1. 事件【点击"确认迁移"按钮】
   - 前置判断：
     - 是否已选择目标分类
       - ❌ 若未选择：提示"请选择目标分类"
     - 目标分类是否为叶子节点
       - ❌ 若不是：提示"只能将资源迁移到叶子节点（标签）"
   - 执行过程：
     - 步骤1：验证目标分类是否存在
     - 步骤2：验证所有选中资源是否为同一类型
     - 步骤3：执行批量资源迁移
     - 步骤4：记录操作日志
   - 结果反馈：
     - ✅ 成功：提示"资源批量迁移成功"，关闭弹窗并刷新资源列表
     - ❌ 失败：提示具体错误原因，撤销全部改动

2. 事件【点击"取消"按钮】
   - 前置判断：无
   - 执行过程：关闭弹窗，放弃批量迁移
   - 结果反馈：无

---

## 8. 操作日志面板

### 8.1 页面入口

| 项目     | 说明                                |
| -------- | ----------------------------------- |
| 入口位置 | 资源管理页 → 顶部导航栏操作日志按钮 |

**页面截图**：

![操作日志](../ref/操作日志.png)
![操作日志-全](../ref/操作日志-全.png)

### 8.2 面板内容

**展示方式**：悬浮面板，显示最近操作记录

**日志字段**：

| 序号 | 字段名称 | 字段说明       | 交互行为 |
| ---- | -------- | -------------- | -------- |
| 1    | 操作时间 | 操作发生的时间 | 无       |
| 2    | 操作类型 | 操作的类型     | 无       |
| 3    | 操作详情 | 操作的具体内容 | 无       |
| 4    | 操作人   | 执行操作的用户 | 无       |

**排序规则**：默认按操作时间倒序排列

**操作类型枚举值**：

| 操作类型 | 说明             |
| -------- | ---------------- |
| 新增资源 | 上传或创建新资源 |
| 编辑资源 | 修改资源信息     |
| 删除资源 | 删除资源         |
| 批量上传 | 批量上传资源     |
| 批量迁移 | 批量迁移资源     |
| 新增分类 | 创建新分类       |
| 编辑分类 | 修改分类信息     |
| 删除分类 | 删除分类         |

### 8.3 页面操作

1. 事件【点击顶部导航栏操作日志按钮】
   - 前置判断：无
   - 执行过程：显示/隐藏操作日志面板
   - 结果反馈：面板显示或隐藏

2. 事件【点击日志记录】
   - 前置判断：无
   - 执行过程：展开/收起日志详情
   - 结果反馈：显示或隐藏日志详细信息
